#!/bin/bash
# Script: batchProcessing-0x02
# Objective: Fetch data for multiple Pokémon with retry logic

POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
OUTPUT_DIR="pokemon_data"
ERROR_LOG="errors.txt"

mkdir -p "$OUTPUT_DIR"
> "$ERROR_LOG" # Clear old errors

# Function to fetch Pokémon data with retries
fetch_pokemon() {
    local pokemon=$1
    local attempts=0
    local max_attempts=3

    echo "Fetching data for $pokemon..."

    while (( attempts < max_attempts )); do
        if curl -s -f "https://pokeapi.co/api/v2/pokemon/$pokemon" -o "$OUTPUT_DIR/${pokemon}.json"; then
            echo "Saved data to $OUTPUT_DIR/${pokemon}.json ✅"
            return 0
        else
            ((attempts++))
            echo "Attempt $attempts for $pokemon failed. Retrying..."
            sleep 2
        fi
    done

    echo "Failed to fetch data for $pokemon ❌" | tee -a "$ERROR_LOG"
    return 1
}

# Loop through Pokémon list
for pokemon in "${POKEMON_LIST[@]}"; do
    fetch_pokemon "$pokemon"
    sleep 2 # Avoid hitting rate limits
done

